<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">

<dom-module id="od-portrait" attributes="query">
  <template>

    <style>
      :host {
        width: 100vw;
        height: 100vh;
        position: absolute;
        touch-action: none;
        overflow: hidden;
      }
      .flex {
        @apply(--layout-flex);
      }
      .container {
        max-width: 77.5rem;
        height: 100vh;
        margin: 0 auto;
        @apply(--layout-horizontal);
        @apply(--layout-end);
      }
      #portrait {
        width: 54.5rem;
        height: 51rem;
        background: cornflowerblue;
        margin-right: -11.25rem;
      }
      /* Mobile Screen Layout Styles */
      :host([small-screen]) {
      }
      .container[mobile-layout] {
        @apply(--layout-vertical);
        @apply(--layout-justified);
      }
      .container[mobile-layout] .flex {
        @apply(--layout-flex-none);
        display: block;
        width: 100%;
        height: 28rem;
      }
      .container[mobile-layout] #portrait {
        position: relative;
        width: 20rem;
        height: 18.7rem;
        margin: 0 auto;
        background: salmon;
      }
    </style>

    <iron-media-query
      query="{{query}}"
      query-matches="{{smallScreen}}">
    </iron-media-query>

    <div class="container" mobile-layout$="{{smallScreen}}">
      <div class="flex"></div>
      <div id="portrait"></div>
    </div>

  </template>

  <script>
    pageStates = {
      HERO: 0,
      ABOUT: 1,
      BODY: 2
    };

    Polymer({

      currentState: pageStates.HERO,

      is: 'od-portrait',

      behaviors: [Polymer.NeonAnimationRunnerBehavior],

      properties: {
        smallScreen: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },

        animationConfig: {
          value: function() {
            return {
              'down-slide': {
                name: 'transform-animation',
                node: this.$.portrait,
                transformTo: 'translateY(80%)'
              },

              'up-slide': {
                name: 'transform-animation',
                node: this.$.portrait,
                transformFrom: 'translateY(80%)',
                transformTo: 'translateY(0)',
                timing: {
                  delay: 100
                }
              }
            }
          }
        }
      },

      listeners: {
        "neon-animation-finish" : "_onNeonAnimationFinish"
      },

      aboutSlide: function() {
        this.currentState = pageStates.ABOUT;
        if (this.smallScreen) {
          this.animationConfig['about-slide'] = {
            name: 'transform-animation',
            node: this.$.portrait,
            transformTo: 'translateY(175%)',
            timing: {
              delay: 375
            }
          };
          this.playAnimation('about-slide');
        } else {
          this.animationConfig['about-slide'] = {
            name: 'transform-animation',
            node: this.$.portrait,
            transformTo: 'translateX(-83.5%)',
            timing: {
              delay: 375
            }
          };
          this.playAnimation('about-slide');
        }
      },

      heroSlide: function() {
        this.currentState = pageStates.HERO;
        if (this.smallScreen) {
          this.animationConfig['hero-slide'] = {
            name: 'transform-animation',
            node: this.$.portrait,
            transformFrom: 'translateY(175%)',
            transformTo: 'translateY(0)',
            timing: {
              delay: 225
            }
          };
          this.playAnimation('hero-slide');
        } else {
          this.animationConfig['hero-slide'] = {
            name: 'transform-animation',
            node: this.$.portrait,
            transformFrom: 'translateX(-83.5%)',
            transformTo: 'translateX(0)',
            timing: {
              delay: 225
            }
          };
          this.playAnimation('hero-slide');
        }
      },

      downSlide: function() {
        this.currentState = pageStates.BODY;
        this.playAnimation('down-slide');
      },

      upSlide: function() {
        this.currentState = pageStates.HERO;
        this.playAnimation('up-slide');
      },

      _onNeonAnimationFinish: function() {
        switch (this.currentState) {
          case pageStates.HERO:
            this.$.portrait.style.transform = 'none';
            this.style.overflow = 'hidden';
            break;
          case pageStates.ABOUT:
            if (this.smallScreen) {
              this.$.portrait.style.transform = 'translateY(175%)';
            } else {
              this.$.portrait.style.transform = 'translateX(-83.5%)';
            }
            this.style.overflow = 'visible';
            break;
          case pageStates.BODY:
            this.$.portrait.style.transform = 'translateY(80%)';
            break;
        }
      }

    });
  </script>
</dom-module>
