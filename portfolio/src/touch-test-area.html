<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">

<dom-module id="touch-test-area">
  <template>
    <style>
      .container {
        width: 100%;
        height: calc(100vh - 13.5rem);
        position: relative;
        @apply(--layout-vertical);
        @apply(--layout-wrap);
      }
      .unit {
        width: 100%;
        height: 100%;
      }
      #unit1 {
        background: cornflowerblue;
      }
      #unit2 {
        background: salmon;
      }
      #unit3 {
        background: limegreen;
      }
    </style>

    <div class="container" id="testarea">
      <div class="unit" id="unit1"></div>
      <div class="unit" id="unit2"></div>
      <div class="unit" id="unit3"></div>
    </div>

  </template>

  <script>
    Polymer({

      is: 'touch-test-area',

      behaviors: [Polymer.NeonAnimationRunnerBehavior],

      properties: {
        animationConfig: {
          value: function() {
            return [];
          }
        }
      },

      listeners: {
        'testarea.track' : 'handleTrack',
        'neon-animation-finish' : '_onNeonAnimationFinish'
      },

      xPos: 0,
      xRelease: 0,
      xDeltaInit: 0,
      xDelta: 0,
      pageNum: 0,
      pageLength: 3,

      handleTrack: function(e) {
        switch(e.detail.state) {
          case 'start' :
            this.xPos = e.detail.x;
            break;
          case 'track' :
            e.currentTarget.style.left = (e.detail.x - this.xPos) + 'px';
            break;
          case 'end' :
            this.xRelease = e.detail.x - this.xPos;
            this.animateSnap(e.currentTarget);
            this.xPos = 0;
            break;
        }
      },

      xDeltaGen: function(direction) {
        var distance = this.$$('.unit').offsetWidth;
        this.xDeltaInit = this.xRelease + (-1 * distance * this.pageNum);

        switch (direction) {
          case 'next':
            this.pageNum++
            break;
          case 'prev':
            this.pageNum--;
            break;
          default:
            this.pageNum;
          };

        this.xDelta = -1 * distance * this.pageNum;
      },

      keyGen: function(element, init, delta) {

        this.animationConfig['translate'] = {
            name: 'transform-animation',
            node: element,
            transformFrom: 'translateX(' + init + 'px)',
            transformTo: 'translateX(' + delta + 'px)',
            timing: {
              duration: 150,
              easing: 'cubic-bezier(0, 0, 0.5, 1.1)'
            }
        }
      },

      animateSnap: function(element) {
        var action = null;

        if (this.xRelease < -400 && this.pageNum < (this.pageLength - 1)) {
          action = 'next';
        } else if (this.xRelease > 400 && this.pageNum > 0) {
          action = 'prev';
        }

        element.style.left = 'auto';

        this.xDeltaGen(action);

        this.keyGen(element, this.xDeltaInit, this.xDelta);

        this.playAnimation('translate');
      },

      _onNeonAnimationFinish: function () {
        this.$$('.container').style.transform = 'translateX(' + this.xDelta + 'px)';
      }
    });
  </script>
</dom-module>
