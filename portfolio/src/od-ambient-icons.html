<link rel="import" href="../bower_components/iron-meta/iron-meta.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-iconset/iron-iconset.html">

<link rel="import" href="od-iconset.html">

<dom-module id="od-ambient-icons">
  <template>
    <style>
      iron-icon {
        display: block;
        position: absolute;
        z-index: 0;
        width: 40px;
        height: 40px;
        top: calc(50% - 20px);
        left: calc(50% - 20px);
        opacity: 0;
      }
    </style>
    <content></content>

    <iron-meta type="iconset" id="meta"><iron-meta>
  </template>

  <script>
    calcAnim = function(element, canvasX, canvasY) {
      var xEnd, yEnd;
      var animKey = [];
      var animTime;
      var mainAxis = Math.random() < 0.5 ? true : false;
      var durationLength = 72000;
      var timingDuration = Math.random() * durationLength;

      var pathDirection = function() {
        if (Math.random() < 0.5) {
          return 1;
        } else {
          return -1;
        }
      }

      if (timingDuration < (durationLength / 2)) {
        timingDuration = timingDuration + (durationLength / 2);
      }

      if (mainAxis) {
        xEnd = (canvasX / 2) * pathDirection();
        yEnd = (canvasY / 2) * Math.random() * pathDirection();
      } else {
        xEnd = (canvasX / 2) * Math.random() * pathDirection();
        yEnd = (canvasY / 2) * pathDirection();
      }

      animKey = [{
          transform: 'translateX(0) translateY(0) rotate(0deg)',
          opacity: 0.28
        }, {
          transform: 'translateX(' + xEnd + 'px) translateY(' + yEnd + 'px) rotate(360deg)',
          opacity: 0
        }];

      animTime = {
          duration: timingDuration,
        };

      var definedAnim = element.animate(animKey, animTime);

      definedAnim.onfinish = function() {
        calcAnim(element, canvasX, canvasY);
      }
    }

    Polymer({

      is: 'od-ambient-icons',

      properties: {
        iconNameList: {
          type: Array,
          value: []
        },
        canvasWidth: {
          value: 0
        },
        canvasHeight: {
          value: 0
        },
        iconsToAnimate: {
          type: Array,
          value: []
        }
      },

      ready: function() {
        this.iconNameList = this.$.meta.byKey('ambient-icons').getIconNames();

        for(i = 0; i < this.iconNameList.length; i++) {
          this.createIcon(this.iconNameList[i]);
        }

        window.addEventListener('WebComponentsReady', function(p) {
          return function () {
            p.canvasWidth = p.$$('iron-icon').parentElement.offsetWidth;
            p.canvasHeight = p.$$('iron-icon').parentElement.offsetHeight;

            for(i = 0; i < p.iconsToAnimate.length; i++) {
              calcAnim(p.iconsToAnimate[i], p.canvasWidth, p.canvasHeight);
            }
          }
        }(this));

        window.addEventListener('resize', function(p) {
          return function () {
            p.canvasWidth = p.$$('iron-icon').parentElement.offsetWidth;
            p.canvasHeight = p.$$('iron-icon').parentElement.offsetHeight;
          }
        }(this));
      },

      createIcon: function(iconName) {
        var newElement = document.createElement('iron-icon');

        newElement.setAttribute('icon', iconName);

        Polymer.dom(this.root).appendChild(newElement);

        this.iconsToAnimate.push(newElement);

        return newElement;
      },
    });
  </script>
</dom-module>
